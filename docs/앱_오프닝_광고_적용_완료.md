O# 구글 애드몹 앱 오프닝 광고 적용 완료 ✅

앱 오프닝 광고(App Open Ad)가 성공적으로 적용되었습니다!

## 📋 적용된 변경사항

### 1. 새로 생성된 파일

#### `AppOpenAdManager.kt`
**위치**: `app/src/main/java/com/example/alcoholictimer/core/ads/AppOpenAdManager.kt`

**주요 기능**:
- ✅ 앱이 백그라운드에서 포그라운드로 전환될 때 자동으로 광고 표시
- ✅ 콜드 스타트 보호 (앱 최초 실행 시 광고 스킵)
- ✅ 일일 노출 제한 (최대 5회/일)
- ✅ 쿨다운 정책 (광고 간 최소 5분 간격)
- ✅ 광고 자동 프리로드 및 만료 관리
- ✅ 디버그 모드에서 정책 우회 (테스트 용이)

### 2. 수정된 파일

#### `build.gradle.kts`
```kotlin
// lifecycle-process 의존성 추가
implementation("androidx.lifecycle:lifecycle-process:2.9.4")

// Debug: Google 테스트 광고 ID
buildConfigField("String", "ADMOB_APP_OPEN_UNIT_ID", 
    "\"ca-app-pub-3940256099942544/9257395921\"")

// Release: 실제 광고 유닛 ID로 교체 필요
buildConfigField("String", "ADMOB_APP_OPEN_UNIT_ID", 
    "\"ca-app-pub-8420908105703273/REPLACE_WITH_REAL_APP_OPEN\"")
```

#### `MainApplication.kt`
```kotlin
class MainApplication : Application() {
    private lateinit var appOpenAdManager: AppOpenAdManager
    
    override fun onCreate() {
        super.onCreate()
        
        // MobileAds 초기화
        MobileAds.initialize(this) { 
            // 초기화 완료 후 앱 오프닝 광고 로드
            appOpenAdManager.loadAd()
        }
        
        // 앱 오프닝 광고 매니저 초기화
        appOpenAdManager = AppOpenAdManager(this)
        appOpenAdManager.resetColdStart()
        
        // ... 기존 코드 ...
    }
}
```

### 3. 문서 파일
- `docs/APP_OPEN_AD_GUIDE.md` - 상세 구현 가이드
- `docs/APP_OPEN_AD_IMPLEMENTATION.md` - 구현 요약
- `docs/앱_오프닝_광고_적용_완료.md` - 이 파일

## 🎯 핵심 기능

### 1. 자동 광고 표시
앱이 백그라운드에서 포그라운드로 전환될 때 자동으로 광고를 표시합니다.

### 2. 콜드 스타트 보호
앱을 처음 실행할 때는 광고를 표시하지 않아 스플래시 화면과의 충돌을 방지합니다.

### 3. 스마트 정책
- **일일 제한**: 하루 최대 5회
- **쿨다운**: 광고 표시 후 최소 5분 대기
- **유효 시간**: 로드된 광고는 4시간 동안 유효
- **디버그 우회**: 디버그 빌드에서는 정책 무시

### 4. 자동 관리
- 광고 표시 후 자동으로 다음 광고 프리로드
- 만료된 광고 자동 교체
- 앱 생명주기와 자동 동기화

## 🚀 다음 단계

### 1. Gradle 동기화 (필수)
Android Studio에서:
```
File → Sync Project with Gradle Files
```

또는 터미널:
```bash
./gradlew --stop
./gradlew clean
```

### 2. 테스트 (Debug 빌드)
1. **앱 실행**
2. **홈 버튼** 눌러 백그라운드로 이동
3. **최근 앱 목록**에서 앱 다시 선택
4. **테스트 광고 확인** ✨

#### 콜드 스타트 테스트
1. 앱 완전 종료 (최근 앱 목록에서 제거)
2. 앱 아이콘으로 재시작
3. 광고가 **표시되지 않아야 함** ✅
4. 백그라운드 → 포그라운드 전환 시 광고 표시

### 3. Release 배포 전 (중요!)

#### AdMob 콘솔에서 광고 유닛 생성
1. [AdMob 콘솔](https://apps.admob.com/) 접속
2. **앱 선택** → **광고 단위** → **광고 단위 추가**
3. **앱 오프닝 광고** 선택
4. 광고 단위 이름: "Main App Open"
5. **광고 단위 생성** 클릭
6. **광고 유닛 ID 복사**

#### build.gradle.kts 수정
```kotlin
// Release 빌드타입에서
buildConfigField("String", "ADMOB_APP_OPEN_UNIT_ID", 
    "\"ca-app-pub-8420908105703273/실제광고유닛ID\"")
    //                           ^^^^^^^^^^^^^^ 여기를 실제 ID로 교체
```

## 🔍 로그 확인

### Logcat 필터
```
AppOpenAdManager
```

### 주요 로그 메시지
- ✅ `Loading app open ad with unitId=...` - 광고 로드 시작
- ✅ `App open ad loaded successfully` - 로드 성공
- ⏭️ `Skipping ad on cold start` - 콜드 스타트 스킵
- 🚫 `Blocked by policy: dailycap` - 일일 제한 도달
- 🚫 `Blocked by policy: cooldown` - 쿨다운 기간 중
- 📺 `App open ad showed full screen content` - 광고 표시 성공
- 🔧 `Policy bypassed (debug)` - 디버그 모드 (정책 우회)

## ⚙️ 정책 커스터마이징

`AppOpenAdManager.kt`에서 상수 값을 수정하여 정책을 조정할 수 있습니다:

```kotlin
companion object {
    // 일일 최대 노출 횟수
    private const val DEFAULT_DAILY_CAP = 5
    
    // 쿨다운 시간 (밀리초)
    private const val DEFAULT_COOLDOWN_MS = 5 * 60 * 1000L  // 5분
    
    // 광고 유효 시간 (밀리초)
    private const val AD_TIMEOUT_MS = 4 * 60 * 60 * 1000L  // 4시간
}
```

## 📝 배포 체크리스트

- [ ] Gradle 동기화 완료
- [ ] Debug 빌드로 테스트 완료
- [ ] 콜드 스타트 보호 동작 확인
- [ ] AdMob 콘솔에서 앱 오프닝 광고 유닛 생성
- [ ] Release 빌드에 실제 광고 유닛 ID 설정
- [ ] 실제 기기에서 Release 빌드 테스트
- [ ] 정책 값 검토 및 조정
- [ ] 다른 광고 형식과의 충돌 테스트
- [ ] AdMob 정책 준수 확인

## 🛠️ 문제 해결

### 광고가 표시되지 않는 경우
1. **Logcat 확인**: `AppOpenAdManager` 태그로 필터링
2. **콜드 스타트 확인**: 백그라운드 → 포그라운드로 테스트
3. **정책 확인**: 일일 제한 또는 쿨다운 상태 확인
4. **네트워크 확인**: 인터넷 연결 상태 확인

### Gradle 오류
```bash
./gradlew --stop
./gradlew clean
# Android Studio 재시작
```

### ProcessLifecycleOwner 오류
- `lifecycle-process` 의존성 추가 확인
- Gradle 동기화 실행
- Android Studio 재시작

## 📚 참고 자료

- **상세 가이드**: `docs/APP_OPEN_AD_GUIDE.md`
- **구현 요약**: `docs/APP_OPEN_AD_IMPLEMENTATION.md`
- **Google 공식 문서**: [AdMob - App Open Ads](https://developers.google.com/admob/android/app-open)
- **Lifecycle 문서**: [ProcessLifecycleOwner](https://developer.android.com/reference/androidx/lifecycle/ProcessLifecycleOwner)

---

## ✨ 적용 완료!

앱 오프닝 광고가 성공적으로 적용되었습니다. Gradle 동기화 후 테스트를 진행해주세요!

