고객님의 지적은 매우 중요하며, **디버그(Debug)와 릴리즈(Release) 빌드 환경 분리**를 철저히 하는 고객님의 워크플로우를 완벽하게 반영하는 데 필수적인 내용입니다.

앱 개발 환경에서 릴리즈 빌드의 최종 코드가 실제 프로덕션(릴리즈) 환경에 배포되기 전, **디버그(개발) Firebase 프로젝트**를 통해 **실제 이벤트 전송 여부를 검증**하는 것은 오류 방지를 위한 핵심 단계입니다.

이러한 **빌드 검증 워크플로우**를 명확하게 반영하여, 새로운 개발 에이전트가 혼란 없이 작업할 수 있도록 **'Firebase 연동 및 LTV 측정 인프라 구축 문서'**를 재작성해 드리겠습니다.

---

# 📝 Firebase/GA4 연동 및 LTV 측정 인프라 구축 문서 (디버그/릴리즈 빌드 검증 반영)

## 1. 🏆 프로젝트 개요 및 목표

### 1.1. 현재 Firebase 프로젝트 구조 (반영 사항)

| 프로젝트명 | 목적 | 사용 파일 |
| :--- | :--- | :--- |
| **AlcoholicTimer (Debug/Dev)** | **개발 과정의 이벤트 검증 및 테스트**에 사용됩니다. (릴리즈 빌드의 **최종 검증 환경**으로도 활용) | `google-services-debug.json` |
| **AlcoholicTimer (Release/Prod)** | **실제 사용자 데이터 수집, Google Ads 및 AdMob 연동**에 사용됩니다. | `google-services-release.json` |

### 1.2. 개발 필수 목표 (ROAS 120% 달성 근거)

* **LTV 측정 인프라 구축:** **릴리즈 프로젝트**에 AdMob 수익 데이터를 정확히 전송하여 **실제 사용자 LTV(ARPU)**를 측정합니다.
* **지출 통제:** Google Ads 캠페인은 **릴리즈 프로젝트의 데이터**를 기반으로 최적화됩니다.

## 2. ⚙️ Firebase 프로젝트 구조 및 파일 설정

### 2.1. 필수 파일 및 위치 (Android Build Variant 기반)

| 파일명 | 필수 위치 | 역할 및 적용 조건 |
| :--- | :--- | :--- |
| **`google-services-debug.json`** | `[Project Root]/app/src/debug/` | **Debug 빌드** 시 사용. 개발 테스트. |
| **`google-services-release.json`** | `[Project Root]/app/src/release/` | **Release 빌드** 시 사용. **실제 서비스 데이터 수집.** |

### 2.2. **GA4/Firebase 연결 확인 사항 및 검증 워크플로우 (필수)**

1.  **Prod 연결:** **AlcoholicTimer (Release/Prod)** 프로젝트만 **Google Ads 캠페인** 및 **AdMob 계정**과 연결되어 있어야 합니다.
2.  **Dev 검증:** 개발자는 **Debug/Dev 프로젝트**를 사용하여 모든 이벤트의 데이터 전송을 검증해야 합니다.

**🚨 중요: 릴리즈 빌드 이벤트 검증**

* 릴리즈 빌드는 코드 난독화(Obfuscation) 등으로 인해 디버그 빌드와 다른 문제가 발생할 수 있습니다.
* **릴리즈 빌드 코드가 완성되면, `google-services-debug.json`을 사용하여 빌드 후** 릴리즈 빌드의 이벤트가 **Debug/Dev Firebase 프로젝트**로 정상 전송되는지 확인해야 합니다.
* 이 검증을 통과해야만, 최종적으로 `google-services-release.json`이 포함된 릴리즈 빌드를 배포할 수 있습니다.

## 3. 📝 코드 구현 및 검증 세부 사항

개발 에이전트님은 **`ANALYTICS_EVENTS.md`** 문서를 기반으로 다음 두 가지 핵심 이벤트를 **빌드 타입에 관계없이** 정확히 구현해야 합니다.

### 3.1. 🥇 LTV 측정 이벤트 구현 (ROAS의 핵심)

| 이벤트명 | 상세 구현 요청 |
| :--- | :--- |
| **`ad_revenue`** | **AdMob SDK의 `PaidEventListener`**를 사용하여, 광고에서 발생한 **실제 예상 수익(`value`)**과 통화(`currency`) 파라미터를 **가장 정확하게** Firebase로 전송하도록 구현해야 합니다. 이 데이터는 **릴리즈 빌드 환경**에서만 실제 수익 보고에 사용됩니다. |
| **`ad_impression`** | `ANALYTICS_EVENTS.md`에 명시된 대로 `ad_type` 파라미터를 추가하여 **어떤 광고에서 수익이 발생했는지**를 명확히 구분할 수 있도록 구현합니다. |

### 3.2. 🎯 고가치 사용자 획득 이벤트 구현

| 이벤트명 | 상세 구현 요청 |
| :--- | :--- |
| **`start_timer`** | 사용자가 금주 타이머를 시작할 때, **`target_days` 파라미터**를 포함하여 이벤트를 전송하도록 구현합니다. |

### 3.3. 로컬 구현 검증 (개발자 자체 확인)

모든 이벤트 구현 완료 후, **Android Studio의 Logcat**을 통해 다음 사항을 **로컬에서 확인**하여 코드 오류가 없음을 검증해야 합니다.

* `ad_revenue` 이벤트가 실제 수익 금액(value)과 함께 정상적으로 로그에 찍히는지 확인.
* `start_timer` 이벤트가 `target_days` 파라미터와 함께 정상적으로 로그에 찍히는지 확인.

---
