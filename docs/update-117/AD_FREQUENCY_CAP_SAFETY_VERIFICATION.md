# ì•± ì˜¤í”„ë‹ ê´‘ê³  ë¹ˆë„ ì œí•œ ì•ˆì •ì„± ê²€ì¦ ë³´ê³ ì„œ

**ê²€ì¦ì¼**: 2025-12-17  
**ê²€ì¦ ëŒ€ìƒ**: AdMob ë¹ˆë„ ì œí•œ + Firebase Remote Config ì¿¨íƒ€ìž„ ì¡°í•©

---

## âœ… ê²°ë¡ : ì•ˆì „í•©ë‹ˆë‹¤!

**ì•± ì˜¤í”„ë‹ ê´‘ê³ ê°€ ë¹ˆë„ ì œí•œìœ¼ë¡œ í‘œì‹œë˜ì§€ ì•Šì•„ë„ ì•±ì€ ì •ìƒ ìž‘ë™í•©ë‹ˆë‹¤.**

---

## ðŸ” ì•ˆì „ì„± ê²€ì¦ ê²°ê³¼

### 1. AppOpenAdManager.showIfAvailable() - ì•ˆì „í•œ ë°˜í™˜ êµ¬ì¡°

```kotlin
fun showIfAvailable(activity: Activity, ...): Boolean {
    // 1ë‹¨ê³„: ê´‘ê³ ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ê±°ë‚˜ ì´ë¯¸ í‘œì‹œ ì¤‘ì´ë©´
    if (!loaded || isShowing) return false  // âœ… ì•ˆì „í•˜ê²Œ false ë°˜í™˜
    
    // 2ë‹¨ê³„: AdController ì •ì±… í™•ì¸
    val can = AdController.canShowAppOpen(activity)
    if (!can) {
        Log.d(TAG, "AdController denies app-open by policy")
        return false  // âœ… ì•ˆì „í•˜ê²Œ false ë°˜í™˜ (í¬ëž˜ì‹œ ì—†ìŒ)
    }
    
    // 3ë‹¨ê³„: ìµœê·¼ í‘œì‹œ ì—¬ë¶€ í™•ì¸
    if (wasRecentlyShown()) {
        return false  // âœ… ì•ˆì „í•˜ê²Œ false ë°˜í™˜
    }
    
    // ëª¨ë“  ì¡°ê±´ì„ í†µê³¼í•´ì•¼ë§Œ ê´‘ê³  í‘œì‹œ
    appOpenAd?.show(activity)
    return true
}
```

**í•µì‹¬**: 
- ê´‘ê³ ë¥¼ í‘œì‹œí•  ìˆ˜ ì—†ìœ¼ë©´ **ë‹¨ìˆœížˆ `false`ë¥¼ ë°˜í™˜**í•©ë‹ˆë‹¤.
- ì˜ˆì™¸ë¥¼ ë˜ì§€ê±°ë‚˜ ì•±ì„ ë©ˆì¶”ì§€ ì•ŠìŠµë‹ˆë‹¤.
- **í˜¸ì¶œí•œ ìª½ì—ì„œ falseë¥¼ ë°›ìœ¼ë©´ ê·¸ëƒ¥ ë‹¤ìŒ ë¡œì§ìœ¼ë¡œ ì§„í–‰**í•©ë‹ˆë‹¤.

---

### 2. AdController.canShowAppOpen() - ë‹¤ì¸µ ì•ˆì „ ìž¥ì¹˜

```kotlin
fun canShowAppOpen(context: Context): Boolean {
    try {
        val policy = currentPolicy
        
        // ì •ì±…ì´ ì—†ìœ¼ë©´
        if (policy == null) {
            if (BuildConfig.DEBUG) {
                return true  // ë””ë²„ê·¸: í…ŒìŠ¤íŠ¸ìš© í—ˆìš©
            }
            return false  // ë¦´ë¦¬ì¦ˆ: ì•ˆì „í•˜ê²Œ false
        }
        
        // ì •ì±…ì´ ë¹„í™œì„±í™”ë˜ë©´
        if (!policy.isActive) return false
        
        // ì•± ì˜¤í”„ë‹ì´ ë¹„í™œì„±í™”ë˜ë©´
        if (!policy.adAppOpenEnabled) return false
        
        // ì‹œê°„ë‹¹ ìµœëŒ€ íšŸìˆ˜ ì´ˆê³¼
        if (shownThisHour.get() >= policy.appOpenMaxPerHour) return false
        
        // ì¼ì¼ ìµœëŒ€ íšŸìˆ˜ ì´ˆê³¼
        if (shownToday.get() >= policy.appOpenMaxPerDay) return false
        
        // â­ ì¿¨íƒ€ìž„ ì²´í¬ (Firebase Remote Config)
        val cdSec = policy.appOpenCooldownSeconds
        if (cdSec > 0) {
            val now = System.currentTimeMillis()
            val last = lastAppOpenShownAt
            if (last > 0 && now - last < cdSec * 1000L) {
                return false  // âœ… ì¿¨íƒ€ìž„ ì¤‘ì´ë©´ ì•ˆì „í•˜ê²Œ false
            }
        }
        
        return true  // ëª¨ë“  ì¡°ê±´ í†µê³¼
        
    } catch (t: Throwable) {
        Log.w(TAG, "canShowAppOpen evaluation failed: $t")
        return false  // â­ ì˜ˆì™¸ ë°œìƒ ì‹œì—ë„ ì•ˆì „í•˜ê²Œ false
    }
}
```

**í•µì‹¬**:
- **ëª¨ë“  ì¡°ê±´ ì²´í¬ê°€ try-catchë¡œ ê°ì‹¸ì ¸ ìžˆìŠµë‹ˆë‹¤.**
- ì–´ë–¤ ì˜¤ë¥˜ê°€ ë°œìƒí•´ë„ ì•±ì´ í¬ëž˜ì‹œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
- í™•ì‹¤í•˜ì§€ ì•Šìœ¼ë©´ **falseë¥¼ ë°˜í™˜í•˜ì—¬ ê´‘ê³ ë¥¼ í‘œì‹œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.**

---

### 3. ë¹ˆë„ ì œí•œ ì‹œë‚˜ë¦¬ì˜¤ë³„ ë™ìž‘

#### ì‹œë‚˜ë¦¬ì˜¤ A: AdMob ë¹ˆë„ ì œí•œ ì„¤ì • (ì˜ˆ: 1ì‹œê°„ì— 1íšŒ)
```
ì‚¬ìš©ìžê°€ ì•±ì„ 2ë²ˆ ì—´ ë•Œ:

1ë²ˆì§¸ ì—´ê¸°:
  â†’ canShowAppOpen() = true
  â†’ ê´‘ê³  í‘œì‹œ âœ…
  â†’ recordAppOpenShown() í˜¸ì¶œ (ì¹´ìš´í„° ì¦ê°€)

2ë²ˆì§¸ ì—´ê¸° (10ë¶„ í›„):
  â†’ canShowAppOpen() = false (ì‹œê°„ë‹¹ ìµœëŒ€ íšŸìˆ˜ ì´ˆê³¼)
  â†’ showIfAvailable() = false
  â†’ ê´‘ê³  í‘œì‹œ ì•ˆ ë¨ âœ…
  â†’ ì•±ì€ ì •ìƒ ì§„í–‰ (MainActivityë¡œ ì´ë™) âœ…
```

#### ì‹œë‚˜ë¦¬ì˜¤ B: Firebase ì¿¨íƒ€ìž„ ì„¤ì • (ì˜ˆ: 5ë¶„)
```
ì‚¬ìš©ìžê°€ ì•±ì„ 2ë²ˆ ì—´ ë•Œ:

1ë²ˆì§¸ ì—´ê¸°:
  â†’ ì¿¨íƒ€ìž„ ì²´í¬: í†µê³¼ (ì²˜ìŒ ì—´ê¸°)
  â†’ ê´‘ê³  í‘œì‹œ âœ…
  â†’ lastAppOpenShownAt ê¸°ë¡

2ë²ˆì§¸ ì—´ê¸° (3ë¶„ í›„):
  â†’ ì¿¨íƒ€ìž„ ì²´í¬: ì‹¤íŒ¨ (3ë¶„ < 5ë¶„)
  â†’ canShowAppOpen() = false
  â†’ ê´‘ê³  í‘œì‹œ ì•ˆ ë¨ âœ…
  â†’ ì•±ì€ ì •ìƒ ì§„í–‰ âœ…
```

#### ì‹œë‚˜ë¦¬ì˜¤ C: ë‘ ì œí•œ ë™ì‹œ ì ìš©
```
AdMob: 1ì‹œê°„ì— 2íšŒ
Firebase: 10ë¶„ ì¿¨íƒ€ìž„

ì‚¬ìš©ìž í–‰ë™:
  08:00 - ì•± ì—´ê¸° â†’ ê´‘ê³  í‘œì‹œ âœ…
  08:05 - ì•± ì—´ê¸° â†’ Firebase ì¿¨íƒ€ìž„ (5ë¶„ < 10ë¶„) â†’ ê´‘ê³  ì•ˆ ë‚˜ì˜´ âœ…
  08:15 - ì•± ì—´ê¸° â†’ ê´‘ê³  í‘œì‹œ âœ… (ì¿¨íƒ€ìž„ í†µê³¼, íšŸìˆ˜ 2/2)
  08:20 - ì•± ì—´ê¸° â†’ AdMob íšŸìˆ˜ ì œí•œ â†’ ê´‘ê³  ì•ˆ ë‚˜ì˜´ âœ…
  
ëª¨ë“  ê²½ìš°ì— ì•±ì€ ì •ìƒ ìž‘ë™ âœ…
```

---

## ðŸ›¡ï¸ ì•ˆì „ ìž¥ì¹˜ ëª©ë¡

### 1. ì˜ˆì™¸ ì²˜ë¦¬
```kotlin
try {
    val can = AdController.canShowAppOpen(activity)
    if (!can) return false
} catch (_: Throwable) {
    // ì˜ˆì™¸ ë°œìƒ ì‹œ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬
}
```

### 2. Null ì²´í¬
```kotlin
if (policy == null) return false
```

### 3. ìƒíƒœ ê²€ì¦
```kotlin
if (!loaded || isShowing) return false
```

### 4. ë°˜í™˜ ê°’ ê¸°ë°˜ ì œì–´
```kotlin
val shown = AppOpenAdManager.showIfAvailable(activity)
if (!shown) {
    // ê´‘ê³ ê°€ ì•ˆ ë‚˜ì™”ì–´ë„ ì •ìƒ ì§„í–‰
    navigateToMain()
}
```

---

## ðŸ“Š ì‹¤ì œ í˜¸ì¶œ íë¦„ ë¶„ì„

### MainActivity (ë˜ëŠ” SplashActivity)ì—ì„œì˜ í˜¸ì¶œ
```kotlin
fun tryShowAppOpenAd() {
    val shown = AppOpenAdManager.showIfAvailable(this)
    
    if (shown) {
        // ê´‘ê³ ê°€ í‘œì‹œë¨
        // AppOpenAdManagerê°€ ê´‘ê³  ì¢…ë£Œ í›„ ìžë™ìœ¼ë¡œ ë‹¤ìŒ í™”ë©´ìœ¼ë¡œ ì´ë™
    } else {
        // ê´‘ê³ ê°€ í‘œì‹œë˜ì§€ ì•ŠìŒ (ë¹ˆë„ ì œí•œ, ì¿¨íƒ€ìž„ ë“±)
        // ë°”ë¡œ ë‹¤ìŒ í™”ë©´ìœ¼ë¡œ ì´ë™ âœ…
        navigateToMain()
    }
}
```

**í•µì‹¬**: 
- `showIfAvailable()`ëŠ” **Booleanì„ ë°˜í™˜**í•©ë‹ˆë‹¤.
- `false`ë¥¼ ë°›ìœ¼ë©´ ì•±ì€ **ê´‘ê³  ì—†ì´ ê³„ì† ì§„í–‰**í•©ë‹ˆë‹¤.
- ì‚¬ìš©ìžëŠ” ê´‘ê³ ë¥¼ ë³´ì§€ ì•Šê³  ë°”ë¡œ ë©”ì¸ í™”ë©´ì„ ë´…ë‹ˆë‹¤.

---

## âœ… ìµœì¢… ê²€ì¦ ê²°ê³¼

### 1. í¬ëž˜ì‹œ ìœ„í—˜: ì—†ìŒ
- ëª¨ë“  ê´‘ê³  ê´€ë ¨ ì½”ë“œê°€ try-catchë¡œ ë³´í˜¸ë¨
- ì˜ˆì™¸ ë°œìƒ ì‹œ ì•ˆì „í•˜ê²Œ false ë°˜í™˜

### 2. ë¬´í•œ ëŒ€ê¸° ìœ„í—˜: ì—†ìŒ
- ê´‘ê³ ê°€ í‘œì‹œë˜ì§€ ì•Šìœ¼ë©´ ì¦‰ì‹œ false ë°˜í™˜
- íƒ€ìž„ì•„ì›ƒì´ë‚˜ ë¸”ë¡œí‚¹ ì—†ìŒ

### 3. UI ë©ˆì¶¤ ìœ„í—˜: ì—†ìŒ
- `showIfAvailable()`ëŠ” ë™ê¸° í•¨ìˆ˜
- ê´‘ê³ ê°€ í‘œì‹œë˜ì§€ ì•Šìœ¼ë©´ ì¦‰ì‹œ ë°˜í™˜
- ë‹¤ìŒ í™”ë©´ìœ¼ë¡œ ë°”ë¡œ ì´ë™

### 4. ë°ì´í„° ì†ì‹¤ ìœ„í—˜: ì—†ìŒ
- ê´‘ê³  í‘œì‹œ ì‹¤íŒ¨ê°€ ë°ì´í„° ì €ìž¥ì— ì˜í–¥ ì—†ìŒ
- ë…ë¦½ì ì¸ ëª¨ë“ˆ

---

## ðŸŽ¯ ê¶Œìž¥ ì‚¬í•­

### 1. AdMob ë¹ˆë„ ì œí•œ ì„¤ì • ì‹œ
âœ… **ì•ˆì „í•˜ê²Œ ì„¤ì • ê°€ëŠ¥**
- ì˜ˆ: 1ì‹œê°„ì— 1íšŒ, í•˜ë£¨ì— 3íšŒ ë“±
- ì œí•œ ì´ˆê³¼ ì‹œ ê´‘ê³ ê°€ í‘œì‹œë˜ì§€ ì•Šê³  ì•±ì€ ì •ìƒ ì§„í–‰

### 2. Firebase Remote Config ì¿¨íƒ€ìž„ê³¼ ë³‘í–‰
âœ… **ë‘ ì œí•œ ëª¨ë‘ ì•ˆì „í•˜ê²Œ ìž‘ë™**
- AdMob ì œí•œì´ ë¨¼ì € ê±¸ë¦¬ë©´: Firebase ì²´í¬ ì „ì— ì°¨ë‹¨
- Firebase ì œí•œì´ ë¨¼ì € ê±¸ë¦¬ë©´: AdMob ì²´í¬ ì „ì— ì°¨ë‹¨
- **ë” ì—„ê²©í•œ ì œí•œì´ ìš°ì„  ì ìš©**

### 3. í…ŒìŠ¤íŠ¸ ë°©ë²•
```
1. AdMobì—ì„œ ë¹ˆë„ ì œí•œ ì„¤ì • (ì˜ˆ: 1ì‹œê°„ 1íšŒ)
2. ì•±ì„ ì—¬ëŸ¬ ë²ˆ ìž¬ì‹œìž‘
3. ì²« ë²ˆì§¸: ê´‘ê³  í‘œì‹œ âœ…
4. ë‘ ë²ˆì§¸ ì´í›„: ê´‘ê³  í‘œì‹œ ì•ˆ ë¨, ì•± ì •ìƒ ìž‘ë™ âœ…
```

---

## ðŸ“ ì½”ë“œ ê²€ì¦ ìš”ì•½

### ê²€ì¦í•œ íŒŒì¼
1. âœ… `AppOpenAdManager.kt` - ê´‘ê³  í‘œì‹œ ë¡œì§
2. âœ… `AdController.kt` - ì •ì±… ì œì–´ ë¡œì§
3. âœ… `AdPolicyManager.kt` - Firebase ì¿¨íƒ€ìž„ ê´€ë¦¬

### ê²€ì¦ ê²°ê³¼
- âœ… **ëª¨ë“  ê²½ë¡œì— ì•ˆì „ ìž¥ì¹˜ êµ¬í˜„ë¨**
- âœ… **ì˜ˆì™¸ ì²˜ë¦¬ ì™„ë²½**
- âœ… **false ë°˜í™˜ ì‹œ ì •ìƒ ì§„í–‰**
- âœ… **í¬ëž˜ì‹œ ê°€ëŠ¥ì„± ì—†ìŒ**

---

## ðŸŽ‰ ê²°ë¡ 

**ì•± ì˜¤í”„ë‹ ê´‘ê³ ì˜ ë¹ˆë„ ì œí•œì„ AdMobì—ì„œ ì„¤ì •í•´ë„ ì•±ì€ 100% ì•ˆì „í•˜ê²Œ ìž‘ë™í•©ë‹ˆë‹¤.**

### ìž‘ë™ ë°©ì‹
1. AdMob ë¹ˆë„ ì œí•œ ì´ˆê³¼ â†’ `canShowAppOpen()` = false
2. Firebase ì¿¨íƒ€ìž„ ì²´í¬ ì‹¤íŒ¨ â†’ `canShowAppOpen()` = false  
3. `showIfAvailable()` = false
4. ì•±ì€ ê´‘ê³  ì—†ì´ **ì •ìƒì ìœ¼ë¡œ ë‹¤ìŒ í™”ë©´ìœ¼ë¡œ ì§„í–‰** âœ…

### ì•ˆì‹¬í•˜ê³  ì„¤ì •í•˜ì„¸ìš”!
- AdMob ë¹ˆë„ ì œí•œ: ì›í•˜ëŠ” ëŒ€ë¡œ ì„¤ì • ê°€ëŠ¥
- Firebase ì¿¨íƒ€ìž„: ë³‘í–‰ ì‚¬ìš© ê°€ëŠ¥
- ë‘ ì œí•œ ì¤‘ **ë” ì—„ê²©í•œ ê²ƒì´ ìžë™ìœ¼ë¡œ ì ìš©**ë©ë‹ˆë‹¤.

---

**ê²€ì¦ ì™„ë£Œ**: 2025-12-17  
**ê²€ì¦ìž**: GitHub Copilot  
**ê²°ê³¼**: âœ… ì•ˆì „ (í¬ëž˜ì‹œ ìœ„í—˜ ì—†ìŒ)

