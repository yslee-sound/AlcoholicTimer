안녕하세요! 제공해주신 광고 정책 단위 테스트 방침과 팝업 정책 단위 테스트 방침 문서를 검토하여, 두 기능이 **AdMob 정책을 위반하지 않고 (광고 중첩 방지)** 올바르게 연동되도록 **통합 단위 테스트 항목**을 추가하고 업데이트하겠습니다. 👍

두 문서 모두 매우 상세하고 훌륭하게 작성되어 있습니다. 특히 `ad_policy` 문서에는 이미 **P5: full-screen 플래그 및 리스너 동작 검증** 항목이 있어, 팝업과의 통합을 위한 기본 구조는 갖춰져 있습니다.

업데이트의 핵심은 **"팝업이 뜰 때 광고에게 '나 지금 화면 전체를 가리고 있어'라고 알려주고, 광고는 그 말을 듣고 노출을 거부하는지"**를 검증하는 것입니다.

---

## 1. 당신이 알고 이해하려고 하는 것

지금은 **광고(Ad) 로직**과 **팝업(Notice) 로직**이 **AdMob 정책 위반(중첩)을 방지**하기 위해 서로의 상태를 참조하며 올바르게 작동하는지 확인하는 **통합 단위 테스트 시나리오**를 두 정책 문서에 **공식적으로 반영**하여 시스템의 안전성을 최종적으로 확보하려고 합니다.

---

## 2. 팝업 정책 단위 테스트 방침 (책임 명시)

`팝업 정책 단위 테스트 방침.md` 문서에 **팝업이 표시될 때 광고 시스템에 알리는 책임**을 명시합니다.

### 📜 `팝업 정책 단위 테스트 방침.md` 업데이트 (추가)

#### 🟢 **광고 연동 책임 (Cross-Module Responsibility)** 추가

팝업 매니저(`PopupManager`)는 **화면 전체를 가리는 팝업** (긴급 공지, 강제 업데이트, 주요 공지 팝업 등)을 표시할 때, **광고 시스템(`AdController` 등)**에 해당 상태를 반드시 알려야 합니다.

| 책임 항목 | 설명 | 검증 대상 |
| :--- | :--- | :--- |
| **광고 플래그 업데이트** | `PopupManager`가 **PopupResult.Emergency**, **PopupResult.ForceUpdate**, 또는 **Full-Screen Notice**를 표시할 때, `AdController.setFullScreenAdShowing(true)`를 호출해야 함. | `PopupManagerTest` |
| **플래그 해제** | 해당 팝업이 **닫히거나(Dismissed)** 완료될 때, `AdController.setFullScreenAdShowing(false)`를 호출하여 광고 노출을 재개할 수 있도록 상태를 해제해야 함. | `PopupManagerTest` |

#### 🟢 **권장 테스트 케이스**에 통합 연동 항목 추가 (구현 요청)

* `Integration_AdFlag_OnShow`: `PopupManager`가 긴급 공지를 표시한 직후, `AdController.isFullScreenShowingNow()` 플래그가 **True**인지 검증.
* `Integration_AdFlag_OnDismiss`: 긴급 공지 팝업이 닫힌 후, `AdController.isFullScreenShowingNow()` 플래그가 **False**로 해제되었는지 검증.

---

## 3. 광고 정책 단위 테스트 방침 (통합 검증 추가)

`ad_policy 단위테스트 방침.md` 문서에 **팝업 상태를 참조하는 통합 테스트 시나리오**를 추가하여 광고 노출 결정 로직의 안정성을 최종적으로 확보합니다.

### 📜 `ad_policy 단위테스트 방침.md` 업데이트 (추가)

#### 🟢 **중요 테스트 항목 요약 (P1..P7)**에 통합 시나리오 추가

기존 P1~P7 목록에 다음 **통합 검증 시나리오(I1)**를 추가하여 광고 로직이 팝업 상태를 참조하는지 확인합니다.

| No. | 통합 테스트 시나리오 | 대상 로직/함수 | 기대하는 결과 (Pass 조건) |
| :--- | :--- | :--- | :--- |
| **I1** | **팝업 활성 중 광고 노출 거부 (통합)** | `AdManager.canShowAd()` | 선행 조건: `AdController.isFullScreenShowingNow()` 플래그가 **True**일 때 (팝업이 떠 있다는 의미), **앱 오프닝 및 전면 광고**에 대한 `canShowAd()` 호출은 **False**를 반환해야 함. |

#### 🟢 **테스트 대상 요약** 섹션 업데이트

`AdManager` 테스트 대상에 **팝업 상태 참조**에 대한 내용을 추가하여, 로직의 책임을 명확히 합니다.

* **AdManager** (패키지: `com.alcoholictimer.ad`)
    * ... (기존 내용 유지)
    * **통합 노출 제어:** `AdController.isFullScreenShowingNow()` 플래그가 **True**인 경우, **광고 노출 정책(쿨다운, 카운트)과 무관하게** 앱 오프닝 및 전면 광고의 노출이 거부되는지 검증.

---

## 4. 최종 결론

이러한 업데이트를 통해 두 모듈은 서로의 상태를 존중하게 됩니다.

1.  **팝업:** 뜰 때 `AdController`에게 **"화면 가리는 중"**이라고 알리고.
2.  **광고:** `AdManager`는 광고를 띄우기 전에 `AdController`에게 **"지금 화면 가리는 중이야?"**라고 물어봐서 노출을 결정합니다.

**광고 중첩 및 정책 위반 위험이 단위 테스트 레벨에서 방지**되도록 보장할 수 있습니다. 이제 이 내용을 에이전트(개발팀)에 전달하여 통합 테스트를 완료할 수 있습니다.