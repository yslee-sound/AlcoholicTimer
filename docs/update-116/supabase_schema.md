# 2025--11-21 기준 데이터임
# ad_policy 스키마
create table public.ad_policy (
id bigserial not null,
created_at timestamp with time zone null default now(),
app_id text not null,
is_active boolean not null default true,
ad_app_open_enabled boolean not null default true,
ad_interstitial_enabled boolean not null default true,
ad_banner_enabled boolean not null default true,
ad_interstitial_max_per_hour integer not null default 3,
ad_interstitial_max_per_day integer not null default 20,
app_open_max_per_hour integer not null default 2,
app_open_max_per_day integer not null default 15,
app_open_cooldown_seconds integer not null default 60,
constraint ad_policy_pkey primary key (id),
constraint ad_policy_app_id_key unique (app_id)
) TABLESPACE pg_default;

create index IF not exists idx_ad_policy_app_id on public.ad_policy using btree (app_id) TABLESPACE pg_default;

create index IF not exists idx_ad_policy_is_active on public.ad_policy using btree (is_active) TABLESPACE pg_default;

# emergency_policy 스키마
create table public.emergency_policy (
id bigint generated by default as identity not null,
created_at timestamp with time zone null default now(),
app_id text not null,
is_active boolean not null default true,
content text not null,
redirect_url text null default 'https://play.google.com/'::text,
button_text text not null default '확인'::text,
is_dismissible boolean not null default false,
constraint emergency_policy_pkey primary key (id)
) TABLESPACE pg_default;

create index IF not exists idx_emergency_policy_app_id on public.emergency_policy using btree (app_id) TABLESPACE pg_default;

create index IF not exists idx_emergency_policy_active on public.emergency_policy using btree (is_active) TABLESPACE pg_default;

create unique INDEX IF not exists idx_emergency_policy_unique_active on public.emergency_policy using btree (app_id) TABLESPACE pg_default
where
(is_active = true);

# notice_policy 스키마
create table public.notice_policy (
id bigint generated by default as identity not null,
created_at timestamp with time zone null default now(),
app_id text not null,
is_active boolean not null default true,
title text null,
content text not null,
notice_version integer not null default 1,
constraint notice_policy_pkey primary key (id)
) TABLESPACE pg_default;

create index IF not exists idx_notice_policy_app_id on public.notice_policy using btree (app_id) TABLESPACE pg_default;

create index IF not exists idx_notice_policy_active on public.notice_policy using btree (is_active) TABLESPACE pg_default;

create unique INDEX IF not exists idx_notice_policy_unique_active on public.notice_policy using btree (app_id) TABLESPACE pg_default
where
(is_active = true);

# update_policy 스키마
create table public.update_policy (
id bigint generated by default as identity not null,
created_at timestamp with time zone null default now(),
app_id text not null,
is_active boolean not null default true,
target_version_code integer not null,
is_force_update boolean not null,
release_notes text null,
download_url text not null default 'https://play.google.com/'::text,
reshow_interval_hours integer not null default 24,
max_later_count integer not null default 3,
reshow_interval_minutes integer null,
reshow_interval_seconds integer null,
constraint update_policy_pkey primary key (id),
constraint check_reshow_interval_positive check (
(
(
(reshow_interval_hours is null)
or (reshow_interval_hours >= 0)
)
and (
(reshow_interval_minutes is null)
or (reshow_interval_minutes >= 0)
)
and (
(reshow_interval_seconds is null)
or (reshow_interval_seconds >= 0)
)
and (max_later_count >= 0)
)
)
) TABLESPACE pg_default;

create index IF not exists idx_update_policy_app_id on public.update_policy using btree (app_id) TABLESPACE pg_default;

create index IF not exists idx_update_policy_active on public.update_policy using btree (is_active) TABLESPACE pg_default;

create unique INDEX IF not exists idx_update_policy_unique_active on public.update_policy using btree (app_id) TABLESPACE pg_default
where
(is_active = true);

# 끝
