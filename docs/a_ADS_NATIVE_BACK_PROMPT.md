# [Prompt] Native Ad on Back Press (Îí§Î°úÍ∞ÄÍ∏∞ ÎÑ§Ïù¥Ìã∞Î∏å Í¥ëÍ≥† ÌåùÏóÖ) ‚Äî ÏôÑÏ†Ñ Íµ¨ÌòÑ Í∞ÄÏù¥Îìú

## üìã Î¨∏ÏÑú Ï†ïÎ≥¥

**Î¨∏ÏÑú Î≤ÑÏ†Ñ**: v1.0.0  
**ÏµúÏ¢Ö ÏàòÏ†ïÏùº**: 2025-01-19  
**ÎåÄÏÉÅ ÌîåÎû´Ìèº**: Android (Kotlin + Compose)  
**AdMob SDK Î≤ÑÏ†Ñ**: 23.0.0+  
**Ï†ÅÏö© Ïï±**: AlcoholicTimer (ÏµúÏ¥à Íµ¨ÌòÑ)

## üìù Î≥ÄÍ≤Ω Ïù¥Î†•

| Î≤ÑÏ†Ñ | ÎÇ†Ïßú | Î≥ÄÍ≤Ω ÎÇ¥Ïö© | ÏûëÏÑ±Ïûê |
|------|------|-----------|--------|
| v1.0.0 | 2025-01-19 | ÏµúÏ¥à ÏûëÏÑ± - AlcoholicTimer Ïï±ÏóêÏÑú ÎÑ§Ïù¥Ìã∞Î∏å Í¥ëÍ≥† Íµ¨ÌòÑ ÏôÑÎ£å | AI Agent |

## üéØ Î¨∏ÏÑú Î™©Ï†Å

Ïù¥ Î¨∏ÏÑúÎäî **Îã§Î•∏ Ïï±ÏóêÏÑúÎèÑ ÎèôÏùºÌïú ÎÑ§Ïù¥Ìã∞Î∏å Í¥ëÍ≥† Ìå®ÌÑ¥ÏùÑ Ïû¨ÏÇ¨Ïö©**Ìï† Ïàò ÏûàÎèÑÎ°ù ÏûëÏÑ±Îêú AI ÏóêÏù¥Ï†ÑÌä∏Ïö© ÌîÑÎ°¨ÌîÑÌä∏ÏûÖÎãàÎã§.

- ÎèôÏùº Base(Compose, BaseActivity Îì±)Î•º Í≥µÏú†ÌïòÎäî Ïï±ÏóêÏÑú "Îí§Î°úÍ∞ÄÍ∏∞ Ïãú Ï¢ÖÎ£å ÌôïÏù∏ ÌåùÏóÖ + ÎÑ§Ïù¥Ìã∞Î∏å Í¥ëÍ≥†" Ìå®ÌÑ¥ÏùÑ Íµ¨ÌòÑ
- Google AdMob Ï†ïÏ±Ö ÏôÑÏ†Ñ Ï§ÄÏàò
- ÏÇ¨Ïö©Ïûê Í≤ΩÌóòÏùÑ Ìï¥ÏπòÏßÄ ÏïäÎäî ÏïàÏ†ÑÌïú Í¥ëÍ≥† ÎÖ∏Ï∂ú

## ‚ö†Ô∏è Ï†ïÏ±Ö Ï§ÄÏàò ÌïÑÏàòÏÇ¨Ìï≠ (Ï§ëÏöî!)

**Google Ads Ï†ïÏ±Ö ÏúÑÎ∞ò Ïãú Ïï±Ïù¥ Play StoreÏóêÏÑú Ï†úÏû¨Î∞õÏùÑ Ïàò ÏûàÏäµÎãàÎã§.**

### Í∏àÏßÄ ÏÇ¨Ìï≠
- ‚ùå ÏÇ¨Ïö©ÏûêÏùò Ïï± Ï¢ÖÎ£åÎ•º Î∂ÄÎãπÌïòÍ≤å Î∞©Ìï¥ÌïòÎäî Í¥ëÍ≥†
- ‚ùå Í¥ëÍ≥†Î•º ÌÅ¥Î¶≠ÌïòÎèÑÎ°ù Ïú†ÎèÑÌïòÎäî ÌÖçÏä§Ìä∏/Í∑∏ÎûòÌîΩ
- ‚ùå Í¥ëÍ≥†ÏôÄ 'Ï¢ÖÎ£å' Î≤ÑÌäºÏùÑ ÌòºÎèô Í∞ÄÎä•ÌïòÍ≤å Î∞∞Ïπò
- ‚ùå UMP ÎèôÏùò Ï†Ñ Í¥ëÍ≥† Î°úÎìú

### ÌïÑÏàò Íµ¨ÌòÑ ÏÇ¨Ìï≠
- ‚úÖ Ï¢ÖÎ£å/Ï∑®ÏÜå Î≤ÑÌäºÏù¥ Í¥ëÍ≥†Î≥¥Îã§ Î™ÖÌôïÌïòÍ≤å ÌëúÏãú
- ‚úÖ Í¥ëÍ≥†Í∞Ä ÏóÜÏñ¥ÎèÑ ÌåùÏóÖÏùÄ Ï†ïÏÉÅ ÏûëÎèô
- ‚úÖ ÏùºÏùº ÎÖ∏Ï∂ú Ï†úÌïú (1-2Ìöå)
- ‚úÖ Í¥ëÍ≥†Ïóê "Ad" ÎùºÎ≤® Î™ÖÏãúÏ†Å ÌëúÏãú
- ‚úÖ Ï¶âÏãú Ï¢ÖÎ£å Í∞ÄÎä• (Ï∂îÍ∞Ä Îã®Í≥Ñ Í∞ïÏöî Í∏àÏßÄ)

---

## üöÄ AI ÏóêÏù¥Ï†ÑÌä∏ Ïã§Ìñâ ÌîÑÎ°¨ÌîÑÌä∏

> ÏïÑÎûò ÎÇ¥Ïö©ÏùÑ AI ÏΩîÎî© ÏóêÏù¥Ï†ÑÌä∏ÏóêÍ≤å Í∑∏ÎåÄÎ°ú Î≥µÏÇ¨ÌïòÏó¨ Ï†ÑÎã¨ÌïòÏÑ∏Ïöî.

### ÏûëÏóÖ Í∞úÏöî

Android Ïï±Ïóê **Îí§Î°úÍ∞ÄÍ∏∞ Ïãú Ï¢ÖÎ£å ÌôïÏù∏ ÌåùÏóÖ + ÎÑ§Ïù¥Ìã∞Î∏å Í¥ëÍ≥†**Î•º Íµ¨ÌòÑÌï©ÎãàÎã§. Îã§Ïùå 5Í∞ú ÌååÏùºÏùÑ ÏÉùÏÑ±/ÏàòÏ†ïÌï©ÎãàÎã§:

1. `app/build.gradle.kts` - BuildConfig ÏÑ§Ï†ï
2. `NativeAdManager.kt` - Í¥ëÍ≥† Î°úÎçî Ïã±Í∏ÄÌÜ§
3. `NativeViewBinder.kt` - Í¥ëÍ≥† Î∑∞ Î∞îÏù∏Îî© Ïú†Ìã∏
4. `include_native_exit_ad.xml` - ÎÑ§Ïù¥Ìã∞Î∏å Í¥ëÍ≥† Î†àÏù¥ÏïÑÏõÉ
5. `NativeExitPopup.kt` - Compose ÌåùÏóÖ UI

### 1Îã®Í≥Ñ: BuildConfig ÏÑ§Ï†ï

**ÌååÏùº**: `app/build.gradle.kts`

```kotlin
// buildFeatures ÏÑπÏÖòÏóê Ï∂îÍ∞Ä
buildFeatures {
    compose = true
    buildConfig = true  // ÌïÑÏàò!
}

// buildTypes ÏÑπÏÖò ÏàòÏ†ï
buildTypes {
    release {
        // ...existing code...
        
        // ÎÑ§Ïù¥Ìã∞Î∏å Í¥ëÍ≥† Ïú†Îãõ ID (Î¶¥Î¶¨Ï¶àÏö© - Ïã§Ï†ú IDÎ°ú ÍµêÏ≤¥ ÌïÑÏöî)
        buildConfigField("String", "ADMOB_NATIVE_UNIT_ID", "\"ca-app-pub-XXXXX/XXXXX\"")
    }
    
    debug {
        // ...existing code...
        
        // ÎÑ§Ïù¥Ìã∞Î∏å Í¥ëÍ≥† ÌÖåÏä§Ìä∏ Ïú†Îãõ ID (Google Í≥µÏãù)
        buildConfigField("String", "ADMOB_NATIVE_UNIT_ID", "\"ca-app-pub-3940256099942544/2247696110\"")
    }
}
```

### 2Îã®Í≥Ñ: NativeAdManager.kt ÏÉùÏÑ±

**ÌååÏùº**: `app/src/main/java/{package}/core/ads/NativeAdManager.kt`

```kotlin
package {YOUR_PACKAGE}.core.ads

import android.content.Context
import android.net.ConnectivityManager
import android.util.Log
import {YOUR_PACKAGE}.BuildConfig
import com.google.android.gms.ads.AdLoader
import com.google.android.gms.ads.AdRequest
import com.google.android.gms.ads.LoadAdError
import com.google.android.gms.ads.nativead.NativeAd
import java.text.SimpleDateFormat
import java.util.Date
import java.util.Locale
import java.util.concurrent.atomic.AtomicBoolean

/**
 * ÎÑ§Ïù¥Ìã∞Î∏å Í¥ëÍ≥† Î°úÎçî Î∞è Ï†ïÏ±Ö Í¥ÄÎ¶¨ Ïã±Í∏ÄÌÜ§
 * - ÎîîÎ≤ÑÍ∑∏: Ï†ïÏ±Ö Ïö∞Ìöå, Ìï≠ÏÉÅ ÌóàÏö©
 * - Î¶¥Î¶¨Ï¶à: ÏùºÏùº Ï∫°(2Ìöå), Ïø®Îã§Ïö¥(2Î∂Ñ), UMP ÎèôÏùò Í≤åÏù¥ÌåÖ
 */
object NativeAdManager {
    private const val TAG = "NativeAdManager"
    private const val GOOGLE_TEST_NATIVE_ID = "ca-app-pub-3940256099942544/2247696110"

    private fun currentUnitId(): String {
        val id = BuildConfig.ADMOB_NATIVE_UNIT_ID
        return if (id.isBlank() || id.contains("XXXXX")) {
            GOOGLE_TEST_NATIVE_ID
        } else {
            id
        }
    }

    // Ï†ïÏ±Ö Í∏∞Î≥∏Í∞í
    private const val DEFAULT_DAILY_CAP = 2
    private const val DEFAULT_COOLDOWN_MS = 2 * 60 * 1000L // 2Î∂Ñ

    private const val PREFS = "ad_prefs"
    private const val KEY_NATIVE_LAST_SHOWN_MS = "native_last_shown_ms"
    private const val KEY_NATIVE_DAILY_COUNT = "native_daily_count"
    private const val KEY_NATIVE_DAILY_DAY = "native_daily_day"

    private var cachedNativeAd: NativeAd? = null
    private val isLoading = AtomicBoolean(false)

    private fun isPolicyBypassed(): Boolean = BuildConfig.DEBUG

    /**
     * ÎÑ§Ïù¥Ìã∞Î∏å Í¥ëÍ≥† ÎØ∏Î¶¨ Î°úÎìú
     */
    fun preload(context: Context) {
        if (isLoading.get()) {
            Log.d(TAG, "Already loading, skip")
            return
        }
        if (cachedNativeAd != null) {
            Log.d(TAG, "Ad already loaded, skip")
            return
        }

        // ÎÑ§Ìä∏ÏõåÌÅ¨ ÏÉÅÌÉú Ï≤¥ÌÅ¨
        val connectivityManager = context.getSystemService(Context.CONNECTIVITY_SERVICE) as? ConnectivityManager
        @Suppress("DEPRECATION")
        val networkInfo = connectivityManager?.activeNetworkInfo
        @Suppress("DEPRECATION")
        if (networkInfo == null || !networkInfo.isConnected) {
            Log.w(TAG, "‚ö†Ô∏è No network connection, skip ad loading")
            return
        }

        isLoading.set(true)
        val unitId = currentUnitId()
        Log.d(TAG, "üîÑ Loading native ad with unitId=$unitId (debug=${BuildConfig.DEBUG})")

        val adLoader = AdLoader.Builder(context, unitId)
            .forNativeAd { nativeAd ->
                Log.d(TAG, "‚úÖ Native ad loaded successfully")
                cachedNativeAd = nativeAd
                isLoading.set(false)
            }
            .withAdListener(object : com.google.android.gms.ads.AdListener() {
                override fun onAdFailedToLoad(error: LoadAdError) {
                    Log.e(TAG, "‚ùå Native ad failed to load:")
                    Log.e(TAG, "   - Error code: ${error.code}")
                    Log.e(TAG, "   - Error message: ${error.message}")
                    
                    when (error.code) {
                        0 -> Log.e(TAG, "   ERROR_CODE_INTERNAL_ERROR")
                        1 -> Log.e(TAG, "   ERROR_CODE_INVALID_REQUEST")
                        2 -> Log.e(TAG, "   ERROR_CODE_NETWORK_ERROR")
                        3 -> Log.e(TAG, "   ERROR_CODE_NO_FILL (Ï†ïÏÉÅ)")
                    }
                    
                    cachedNativeAd = null
                    isLoading.set(false)
                    
                    // ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•ò Ïãú 30Ï¥à ÌõÑ Ïû¨ÏãúÎèÑ
                    if (error.code == 2 || error.code == 0) {
                        android.os.Handler(android.os.Looper.getMainLooper()).postDelayed({
                            preload(context.applicationContext)
                        }, 30000)
                    }
                }
            })
            .build()

        adLoader.loadAd(AdRequest.Builder().build())
    }

    /**
     * Î°úÎìúÎêú ÎÑ§Ïù¥Ìã∞Î∏å Í¥ëÍ≥† ÌöçÎìù (ÏÜåÏú†Í∂å Ïù¥Ï†Ñ)
     */
    fun acquire(context: Context): NativeAd? {
        val ad = cachedNativeAd
        cachedNativeAd = null
        if (ad != null) {
            Log.d(TAG, "‚úÖ Ad acquired, will reload in background")
            android.os.Handler(android.os.Looper.getMainLooper()).postDelayed({
                preload(context.applicationContext)
            }, 1000)
        } else {
            Log.w(TAG, "‚ö†Ô∏è No ad available to acquire")
        }
        return ad
    }

    /**
     * Ï†ïÏ±Ö Ï≤¥ÌÅ¨: Í¥ëÍ≥† ÌëúÏãúÍ∞Ä ÌóàÏö©ÎêòÎäîÏßÄ ÌôïÏù∏
     */
    fun canShowAd(context: Context): Boolean {
        if (isPolicyBypassed()) {
            Log.d(TAG, "Policy bypassed (DEBUG)")
            return true
        }

        val prefs = context.getSharedPreferences(PREFS, Context.MODE_PRIVATE)
        val now = System.currentTimeMillis()
        val todayKey = currentDayKey()

        // ÏùºÏùº Ïπ¥Ïö¥Ìä∏ Ï≤¥ÌÅ¨
        val storedDay = prefs.getString(KEY_NATIVE_DAILY_DAY, "")
        val dailyCount = if (storedDay == todayKey) {
            prefs.getInt(KEY_NATIVE_DAILY_COUNT, 0)
        } else {
            0
        }

        if (dailyCount >= DEFAULT_DAILY_CAP) {
            Log.d(TAG, "Daily cap reached ($dailyCount/$DEFAULT_DAILY_CAP)")
            return false
        }

        // Ïø®Îã§Ïö¥ Ï≤¥ÌÅ¨
        val lastShown = prefs.getLong(KEY_NATIVE_LAST_SHOWN_MS, 0L)
        val elapsed = now - lastShown
        if (elapsed < DEFAULT_COOLDOWN_MS) {
            val remainSec = (DEFAULT_COOLDOWN_MS - elapsed) / 1000
            Log.d(TAG, "Cooldown active (remain ${remainSec}s)")
            return false
        }

        return true
    }

    /**
     * Í¥ëÍ≥† ÌëúÏãú ÌõÑ Ìò∏Ï∂ú (Ï†ïÏ±Ö Ïπ¥Ïö¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏)
     */
    fun recordShown(context: Context) {
        if (isPolicyBypassed()) {
            Log.d(TAG, "Policy bypassed, skip recording")
            return
        }

        val prefs = context.getSharedPreferences(PREFS, Context.MODE_PRIVATE)
        val now = System.currentTimeMillis()
        val todayKey = currentDayKey()

        val storedDay = prefs.getString(KEY_NATIVE_DAILY_DAY, "")
        val dailyCount = if (storedDay == todayKey) {
            prefs.getInt(KEY_NATIVE_DAILY_COUNT, 0)
        } else {
            0
        }

        prefs.edit()
            .putLong(KEY_NATIVE_LAST_SHOWN_MS, now)
            .putInt(KEY_NATIVE_DAILY_COUNT, dailyCount + 1)
            .putString(KEY_NATIVE_DAILY_DAY, todayKey)
            .apply()

        Log.d(TAG, "Recorded show: count=${dailyCount + 1}/$DEFAULT_DAILY_CAP")

        android.os.Handler(android.os.Looper.getMainLooper()).postDelayed({
            preload(context.applicationContext)
        }, 500)
    }

    private fun currentDayKey(): String {
        return SimpleDateFormat("yyyyMMdd", Locale.US).format(Date())
    }
}
```

### 3Îã®Í≥Ñ: NativeViewBinder.kt ÏÉùÏÑ±

**ÌååÏùº**: `app/src/main/java/{package}/core/ads/NativeViewBinder.kt`

```kotlin
package {YOUR_PACKAGE}.core.ads

import android.widget.Button
import android.widget.ImageView
import android.widget.TextView
import com.google.android.gms.ads.nativead.NativeAd
import com.google.android.gms.ads.nativead.NativeAdView
import {YOUR_PACKAGE}.R

/**
 * ÎÑ§Ïù¥Ìã∞Î∏å Í¥ëÍ≥† Î∑∞ Î∞îÏù∏Îî© Ïú†Ìã∏Î¶¨Ìã∞
 */
object NativeViewBinder {
    fun bind(nativeAdView: NativeAdView, nativeAd: NativeAd) {
        // Ìó§ÎìúÎùºÏù∏
        nativeAdView.findViewById<TextView>(R.id.ad_headline)?.let {
            it.text = nativeAd.headline
            nativeAdView.headlineView = it
        }

        // Î≥∏Î¨∏
        nativeAdView.findViewById<TextView>(R.id.ad_body)?.let {
            it.text = nativeAd.body
            nativeAdView.bodyView = it
        }

        // CTA Î≤ÑÌäº
        nativeAdView.findViewById<Button>(R.id.ad_call_to_action)?.let {
            it.text = nativeAd.callToAction ?: "ÏûêÏÑ∏Ìûà Î≥¥Í∏∞"
            nativeAdView.callToActionView = it
        }

        // ÏïÑÏù¥ÏΩò
        nativeAdView.findViewById<ImageView>(R.id.ad_icon)?.let { iconView ->
            nativeAd.icon?.let { icon ->
                iconView.setImageDrawable(icon.drawable)
                nativeAdView.iconView = iconView
            }
        }

        // Í¥ëÍ≥†Ï£º
        nativeAdView.findViewById<TextView>(R.id.ad_advertiser)?.let {
            it.text = nativeAd.advertiser
            nativeAdView.advertiserView = it
        }

        // ÎØ∏ÎîîÏñ¥ Î∑∞
        nativeAdView.findViewById<com.google.android.gms.ads.nativead.MediaView>(R.id.ad_media)?.let {
            nativeAdView.mediaView = it
        }

        nativeAdView.setNativeAd(nativeAd)
    }
}
```

### 4Îã®Í≥Ñ: include_native_exit_ad.xml ÏÉùÏÑ±

**ÌååÏùº**: `app/src/main/res/layout/include_native_exit_ad.xml`

```xml
<?xml version="1.0" encoding="utf-8"?>
<com.google.android.gms.ads.nativead.NativeAdView 
    xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:background="@android:color/white"
    android:padding="12dp">

    <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:orientation="vertical">

        <!-- Í¥ëÍ≥† ÎùºÎ≤® (Ï†ïÏ±Ö ÌïÑÏàò) -->
        <TextView
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_marginBottom="8dp"
            android:text="Ad"
            android:textColor="#999999"
            android:textSize="10sp"
            android:background="#F0F0F0"
            android:paddingStart="6dp"
            android:paddingEnd="6dp"
            android:paddingTop="2dp"
            android:paddingBottom="2dp" />

        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="horizontal"
            android:gravity="center_vertical">

            <ImageView
                android:id="@+id/ad_icon"
                android:layout_width="40dp"
                android:layout_height="40dp"
                android:contentDescription="Ad Icon" />

            <LinearLayout
                android:layout_width="0dp"
                android:layout_height="wrap_content"
                android:layout_weight="1"
                android:layout_marginStart="8dp"
                android:orientation="vertical">

                <TextView
                    android:id="@+id/ad_headline"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:textColor="#000000"
                    android:textSize="14sp"
                    android:textStyle="bold"
                    android:maxLines="2"
                    android:ellipsize="end" />

                <TextView
                    android:id="@+id/ad_advertiser"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:layout_marginTop="2dp"
                    android:textColor="#666666"
                    android:textSize="11sp"
                    android:maxLines="1"
                    android:ellipsize="end" />
            </LinearLayout>
        </LinearLayout>

        <com.google.android.gms.ads.nativead.MediaView
            android:id="@+id/ad_media"
            android:layout_width="match_parent"
            android:layout_height="200dp"
            android:layout_marginTop="12dp" />

        <TextView
            android:id="@+id/ad_body"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginTop="8dp"
            android:textColor="#333333"
            android:textSize="12sp"
            android:maxLines="3"
            android:ellipsize="end" />

        <Button
            android:id="@+id/ad_call_to_action"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginTop="8dp"
            android:minWidth="120dp"
            android:textColor="@android:color/white"
            android:textSize="13sp"
            android:textStyle="bold" />

    </LinearLayout>

</com.google.android.gms.ads.nativead.NativeAdView>
```

### 5Îã®Í≥Ñ: NativeExitPopup.kt ÏÉùÏÑ±

**ÌååÏùº**: `app/src/main/java/{package}/core/ui/NativeExitPopup.kt`

```kotlin
package {YOUR_PACKAGE}.core.ui

import androidx.compose.foundation.BorderStroke
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material3.*
import androidx.compose.runtime.*
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.platform.LocalContext
import androidx.compose.ui.text.style.TextAlign
import androidx.compose.ui.unit.dp
import androidx.compose.ui.viewinterop.AndroidView
import androidx.compose.ui.window.Dialog
import androidx.compose.ui.window.DialogProperties
import android.view.LayoutInflater
import com.google.android.gms.ads.nativead.NativeAd
import com.google.android.gms.ads.nativead.NativeAdView
import {YOUR_PACKAGE}.R
import {YOUR_PACKAGE}.core.ads.NativeAdManager
import {YOUR_PACKAGE}.core.ads.NativeViewBinder

/**
 * Îí§Î°úÍ∞ÄÍ∏∞ Ïãú ÌëúÏãúÎêòÎäî ÎÑ§Ïù¥Ìã∞Î∏å Í¥ëÍ≥† Ìè¨Ìï® Ï¢ÖÎ£å ÌôïÏù∏ ÌåùÏóÖ
 */
@Composable
fun NativeExitPopup(
    visible: Boolean,
    onConfirmExit: () -> Unit,
    onDismiss: () -> Unit
) {
    if (!visible) return

    val context = LocalContext.current
    var nativeAd by remember { mutableStateOf<NativeAd?>(null) }
    var nativeAdView by remember { mutableStateOf<NativeAdView?>(null) }

    val canShowAd = NativeAdManager.canShowAd(context)

    LaunchedEffect(visible) {
        if (visible && canShowAd) {
            android.util.Log.d("NativeExitPopup", "Attempting to acquire native ad...")
            nativeAd = NativeAdManager.acquire(context)
            if (nativeAd != null) {
                android.util.Log.d("NativeExitPopup", "‚úÖ Native ad acquired successfully")
                NativeAdManager.recordShown(context)
            } else {
                android.util.Log.w("NativeExitPopup", "‚ö†Ô∏è No native ad available")
            }
        }
    }

    DisposableEffect(visible) {
        onDispose {
            nativeAdView?.destroy()
            nativeAd?.destroy()
            nativeAd = null
            nativeAdView = null
        }
    }

    Dialog(
        onDismissRequest = onDismiss,
        properties = DialogProperties(
            dismissOnBackPress = true,
            dismissOnClickOutside = false
        )
    ) {
        Card(
            modifier = Modifier
                .fillMaxWidth()
                .padding(16.dp),
            shape = RoundedCornerShape(20.dp),
            colors = CardDefaults.cardColors(
                containerColor = MaterialTheme.colorScheme.surface
            ),
            elevation = CardDefaults.cardElevation(defaultElevation = 8.dp)
        ) {
            Column(
                modifier = Modifier
                    .fillMaxWidth()
                    .padding(20.dp),
                horizontalAlignment = Alignment.CenterHorizontally
            ) {
                // ÌÉÄÏù¥ÌãÄ
                Text(
                    text = "Ïï±ÏùÑ Ï¢ÖÎ£åÌïòÏãúÍ≤†Ïñ¥Ïöî?",
                    style = MaterialTheme.typography.titleLarge,
                    textAlign = TextAlign.Center,
                    modifier = Modifier.padding(bottom = 16.dp)
                )

                // ÎÑ§Ïù¥Ìã∞Î∏å Í¥ëÍ≥† ÏòÅÏó≠
                if (nativeAd != null) {
                    Card(
                        modifier = Modifier
                            .fillMaxWidth()
                            .padding(bottom = 20.dp),
                        shape = RoundedCornerShape(12.dp),
                        colors = CardDefaults.cardColors(
                            containerColor = Color.White
                        ),
                        border = BorderStroke(1.dp, Color.LightGray),
                        elevation = CardDefaults.cardElevation(defaultElevation = 2.dp)
                    ) {
                        AndroidView(
                            factory = { ctx ->
                                val inflater = LayoutInflater.from(ctx)
                                val adView = inflater.inflate(
                                    R.layout.include_native_exit_ad,
                                    null,
                                    false
                                ) as NativeAdView

                                nativeAd?.let { ad ->
                                    NativeViewBinder.bind(adView, ad)
                                }

                                nativeAdView = adView
                                adView
                            },
                            modifier = Modifier.fillMaxWidth()
                        )
                    }
                } else {
                    // Í¥ëÍ≥† ÏóÜÏùÑ Îïå ÌîåÎ†àÏù¥Ïä§ÌôÄÎçî
                    Card(
                        modifier = Modifier
                            .fillMaxWidth()
                            .height(100.dp)
                            .padding(bottom = 20.dp),
                        shape = RoundedCornerShape(12.dp),
                        colors = CardDefaults.cardColors(
                            containerColor = Color(0xFFF5F5F5)
                        ),
                        border = BorderStroke(1.dp, Color.LightGray)
                    ) {
                        Box(
                            modifier = Modifier.fillMaxSize(),
                            contentAlignment = Alignment.Center
                        ) {
                            Text(
                                text = "Í∞êÏÇ¨Ìï©ÎãàÎã§! üíô",
                                style = MaterialTheme.typography.bodyMedium,
                                color = Color.Gray,
                                textAlign = TextAlign.Center
                            )
                        }
                    }
                }

                // Î≤ÑÌäº ÏòÅÏó≠
                Row(
                    modifier = Modifier.fillMaxWidth(),
                    horizontalArrangement = Arrangement.spacedBy(12.dp)
                ) {
                    OutlinedButton(
                        onClick = onDismiss,
                        modifier = Modifier.weight(1f),
                        shape = RoundedCornerShape(12.dp)
                    ) {
                        Text("Ï∑®ÏÜå", style = MaterialTheme.typography.bodyLarge)
                    }

                    Button(
                        onClick = onConfirmExit,
                        modifier = Modifier.weight(1f),
                        shape = RoundedCornerShape(12.dp)
                    ) {
                        Text("Ï¢ÖÎ£å", style = MaterialTheme.typography.bodyLarge)
                    }
                }
            }
        }
    }
}
```

### 6Îã®Í≥Ñ: Activity/ScreenÏóê Ïó∞Îèô

**ÏòàÏãú**: StartActivity ÎòêÎäî Î©îÏù∏ ÌôîÎ©¥

```kotlin
import {YOUR_PACKAGE}.core.ads.NativeAdManager
import {YOUR_PACKAGE}.core.ui.NativeExitPopup
import androidx.activity.compose.BackHandler

// onCreate ÎòêÎäî Ï¥àÍ∏∞Ìôî ÏãúÏ†ê
override fun onCreate(savedInstanceState: Bundle?) {
    super.onCreate(savedInstanceState)
    
    // UMP ÎèôÏùò ÌõÑ Í¥ëÍ≥† ÎØ∏Î¶¨ Î°úÎìú
    UmpConsentManager.requestAndLoadIfRequired(this) { canRequest ->
        if (canRequest) {
            NativeAdManager.preload(this)
        }
    }
}

// Composable ÌôîÎ©¥ ÎÇ¥Î∂Ä
@Composable
fun MainScreen(activity: Activity?) {
    var showExitPopup by remember { mutableStateOf(false) }

    // Îí§Î°úÍ∞ÄÍ∏∞ Ìï∏Îì§Îü¨
    BackHandler(enabled = true) {
        showExitPopup = true
    }

    // ÎÑ§Ïù¥Ìã∞Î∏å Í¥ëÍ≥† ÌåùÏóÖ
    NativeExitPopup(
        visible = showExitPopup,
        onConfirmExit = {
            activity?.finish()
        },
        onDismiss = {
            showExitPopup = false
        }
    )
    
    // ...existing UI code...
}
```

### 7Îã®Í≥Ñ: AndroidManifest.xml ÌôïÏù∏

AdMob App IDÍ∞Ä ÏÑ§Ï†ïÎêòÏñ¥ ÏûàÎäîÏßÄ ÌôïÏù∏:

```xml
<application>
    <!-- ...existing code... -->
    
    <meta-data
        android:name="com.google.android.gms.ads.APPLICATION_ID"
        android:value="ca-app-pub-XXXXXXXXXXXXXXXX~XXXXXXXXXX"/>
</application>
```

### 8Îã®Í≥Ñ: MainApplication.kt Ï¥àÍ∏∞Ìôî

**ÌååÏùº**: `app/src/main/java/{package}/MainApplication.kt`

```kotlin
import com.google.android.gms.ads.MobileAds
import com.google.android.gms.ads.RequestConfiguration

class MainApplication : Application() {
    override fun onCreate() {
        super.onCreate()
        
        // AdMob Ï¥àÍ∏∞Ìôî
        val config = RequestConfiguration.Builder()
            .setMaxAdContentRating(RequestConfiguration.MAX_AD_CONTENT_RATING_T)
            .build()
        MobileAds.setRequestConfiguration(config)
        MobileAds.initialize(this) { initStatus ->
            android.util.Log.d("MainApplication", "MobileAds initialized: $initStatus")
        }
    }
}
```

---

## ‚úÖ Íµ¨ÌòÑ Í≤ÄÏ¶ù Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏

### Í∏∞Îä• ÌÖåÏä§Ìä∏
- [ ] ÎîîÎ≤ÑÍ∑∏ ÎπåÎìú Ïãú ÌÖåÏä§Ìä∏ Í¥ëÍ≥†Í∞Ä Î°úÎìúÎêòÎäîÍ∞Ä?
- [ ] Í¥ëÍ≥† ÏÉÅÎã®Ïóê "Ad" ÎùºÎ≤®Ïù¥ ÌëúÏãúÎêòÎäîÍ∞Ä?
- [ ] Îí§Î°úÍ∞ÄÍ∏∞ Ïãú ÌåùÏóÖÏù¥ Ï†ïÏÉÅ ÌëúÏãúÎêòÎäîÍ∞Ä?
- [ ] Í¥ëÍ≥†Í∞Ä ÏóÜÏùÑ ÎïåÎèÑ ÌåùÏóÖÏù¥ Ï†ïÏÉÅ ÏûëÎèôÌïòÎäîÍ∞Ä?
- [ ] "Ï∑®ÏÜå" Î≤ÑÌäºÏúºÎ°ú ÌåùÏóÖÏùÑ Îã´ÏùÑ Ïàò ÏûàÎäîÍ∞Ä?
- [ ] "Ï¢ÖÎ£å" Î≤ÑÌäºÏúºÎ°ú Ïï±Ïù¥ Ï¢ÖÎ£åÎêòÎäîÍ∞Ä?

### Ï†ïÏ±Ö Ï§ÄÏàò
- [ ] Ï¢ÖÎ£å/Ï∑®ÏÜå Î≤ÑÌäºÏù¥ Í¥ëÍ≥†Î≥¥Îã§ Î™ÖÌôïÌïúÍ∞Ä?
- [ ] Í¥ëÍ≥†Î•º ÌÅ¥Î¶≠ÌïòÎèÑÎ°ù Ïú†ÎèÑÌïòÎäî ÌÖçÏä§Ìä∏Í∞Ä ÏóÜÎäîÍ∞Ä?
- [ ] ÏùºÏùº 2Ìöå Ïù¥ÏÉÅ ÌëúÏãúÎêòÏßÄ ÏïäÎäîÍ∞Ä?
- [ ] UMP ÎèôÏùò Ï†ÑÏóêÎäî Í¥ëÍ≥†Í∞Ä Î°úÎìúÎêòÏßÄ ÏïäÎäîÍ∞Ä?

### Î°úÍ∑∏ ÌôïÏù∏
LogcatÏóêÏÑú Îã§Ïùå ÌÉúÍ∑∏Î°ú ÌïÑÌÑ∞ÎßÅ:
- `NativeAdManager`
- `NativeExitPopup`

Ï†ïÏÉÅ Î°úÍ∑∏:
```
üîÑ Loading native ad with unitId=...
‚úÖ Native ad loaded successfully
‚úÖ Ad acquired successfully
```

---

## üêõ Î¨∏Ï†ú Ìï¥Í≤∞

### Í¥ëÍ≥†Í∞Ä ÌëúÏãúÎêòÏßÄ ÏïäÏùÑ Îïå

1. **Logcat ÏóêÎü¨ ÏΩîÎìú ÌôïÏù∏**
   - `ERROR_CODE_0`: ÎÇ¥Î∂Ä Ïò§Î•ò (Ïû¨ÏãúÎèÑ Îê®)
   - `ERROR_CODE_1`: ÏûòÎ™ªÎêú ÏöîÏ≤≠ (Ïú†Îãõ ID ÌôïÏù∏)
   - `ERROR_CODE_2`: ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•ò (Ïù∏ÌÑ∞ÎÑ∑ Ïó∞Í≤∞ ÌôïÏù∏)
   - `ERROR_CODE_3`: Í¥ëÍ≥† ÏóÜÏùå (ÌÖåÏä§Ìä∏ Í¥ëÍ≥†Îäî Ìï≠ÏÉÅ ÏûàÏñ¥Ïïº Ìï®)

2. **BuildConfig ÌôïÏù∏**
   - `BuildConfig.ADMOB_NATIVE_UNIT_ID`Í∞Ä Ïò¨Î∞îÎ•∏ Í∞íÏù∏ÏßÄ ÌôïÏù∏
   - Gradle Sync ÌõÑ Clean Build Ïã§Ìñâ

3. **ÎÑ§Ìä∏ÏõåÌÅ¨ ÌôïÏù∏**
   - ÏóêÎÆ¨Î†àÏù¥ÌÑ∞/Í∏∞Í∏∞Í∞Ä Ïù∏ÌÑ∞ÎÑ∑Ïóê Ïó∞Í≤∞ÎêòÏñ¥ ÏûàÎäîÏßÄ ÌôïÏù∏

4. **UMP ÎèôÏùò ÌôïÏù∏**
   - UMP ÎèôÏùòÍ∞Ä ÏôÑÎ£åÎêú ÌõÑ Í¥ëÍ≥†Í∞Ä Î°úÎìúÎêòÎäîÏßÄ ÌôïÏù∏

---

## üìö Ï∞∏Í≥† ÏûêÎ£å

- [Google AdMob Native Ads Ï†ïÏ±Ö](https://support.google.com/admob/answer/6329638)
- [Native Ads Advanced Í∞ÄÏù¥Îìú](https://developers.google.com/admob/android/native/advanced)
- [AdMob Ï†ïÏ±Ö ÏÑºÌÑ∞](https://support.google.com/admob/answer/6128543)

---

## üîÑ Ìñ•ÌõÑ Í∞úÏÑ† Í≥ÑÌöç

- v1.1.0: ÎÑ§Ïù¥Ìã∞Î∏å Í¥ëÍ≥† A/B ÌÖåÏä§Ìä∏ ÏßÄÏõê
- v1.2.0: Îã§ÏñëÌïú Î†àÏù¥ÏïÑÏõÉ ÌÖúÌîåÎ¶ø Ï†úÍ≥µ
- v2.0.0: ÏûêÎèô ÏµúÏ†ÅÌôî Í∏∞Îä• Ï∂îÍ∞Ä

---

## üìå Ï†ÅÏö© Ïãú Ï£ºÏùòÏÇ¨Ìï≠

1. **Ìå®ÌÇ§ÏßÄÎ™Ö ÍµêÏ≤¥**: Î™®Îì† `{YOUR_PACKAGE}`Î•º Ïã§Ï†ú Ìå®ÌÇ§ÏßÄÎ™ÖÏúºÎ°ú ÍµêÏ≤¥
2. **Î¶¨ÏÜåÏä§ ID ÌôïÏù∏**: `R.id.*` Î¶¨ÏÜåÏä§Í∞Ä ÌîÑÎ°úÏ†ùÌä∏Ïóê ÎßûÍ≤å ÏÑ§Ï†ïÎêòÏóàÎäîÏßÄ ÌôïÏù∏
3. **ÏÉâÏÉÅ Î¶¨ÏÜåÏä§**: ÌïÑÏöî Ïãú `Color.LightGray` Îì±ÏùÑ ÌîÑÎ°úÏ†ùÌä∏Ïùò ÏÉâÏÉÅ Î¶¨ÏÜåÏä§Î°ú ÍµêÏ≤¥
4. **ÌÖçÏä§Ìä∏ Îã§Íµ≠Ïñ¥Ìôî**: ÌïòÎìúÏΩîÎî©Îêú ÌÖçÏä§Ìä∏Î•º `strings.xml`Î°ú Ïù¥Îèô

---

**Î¨∏ÏÑú ÏûëÏÑ± ÏôÑÎ£å**. Ïù¥ Í∞ÄÏù¥ÎìúÎ•º AI ÏóêÏù¥Ï†ÑÌä∏ÏóêÍ≤å Ï†ÑÎã¨ÌïòÏó¨ Îã§Î•∏ Ïï±ÏóêÎèÑ ÎèôÏùºÌïú Ìå®ÌÑ¥ÏùÑ Ï†ÅÏö©ÌïòÏÑ∏Ïöî.

