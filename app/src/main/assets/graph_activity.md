# 금주 기록 그래프 기능 구현 기획서

## 📋 프로젝트 개요
- **대상 화면**: RecordsActivity (금주 기록 화면)
- **구현 목적**: 사용자의 금주 성과를 시각적으로 표현하여 동기부여 제공
- **기술 스택**: Jetpack Compose Canvas, Kotlin

## 🎯 기능 요구사항

### 1. 초기 요구사항
```
"그래프 기능 만들어 줘, 
x 축은 주, 월, 년 
y 축은 수치, 
성공한 금주가 1개라도 있으면 1의 값을 한다."
```

### 2. 상세 요구사항 분석
- **그래프 타입**: 막대 그래프 (Bar Chart)
- **X축**: 기간별 구분 (주/월/년/전체)
- **Y축**: 성공 여부 (0 또는 1의 이진 값)
- **데이터 로직**: 해당 기간에 성공한 금주가 1개 이상 있으면 1, 없으면 0

## 📊 그래프 모드별 세부 사양

### 주 모드 (Weekly View)
- **X축**: 일, 월, 화, 수, 목, 금, 토 (7개 막대)
- **Y축**: 0, 1
- **데이터**: 이번 주 각 요일별로 성공한 금주 기록 존재 여부
- **예시**: 월요일에 성공한 금주가 있으면 월요일 막대는 1

### 월 모드 (Monthly View)
- **X축**: 1일 ~ 마지막일 (28~31개 막대)
- **Y축**: 0, 1
- **레이블**: 5일 단위로 표시 (1, 5, 10, 15, 20, 25, 마지막일)
- **데이터**: 선택한 월의 각 일별로 성공한 금주 기록 존재 여부

### 년 모드 (Yearly View)
- **X축**: 1월 ~ 12월 (12개 막대)
- **Y축**: 0, 1 (또는 성공 횟수에 따라 동적 조정)
- **데이터**: 선택한 년도의 각 월별로 성공한 금주 기록 존재 여부

### 전체 모드 (All Time View)
- **X축**: 년도별 (2023년, 2024년, 2025년 등)
- **Y축**: 0, 1 (또는 성공 횟수에 따라 동적 조정)
- **데이터**: 각 년도별로 성공한 금주 기록 존재 여부

## 🎨 UI/UX 디자인 요구사항

### 기간 선택 UI
- **스타일**: iOS 스타일 Segmented Control
- **배경**: 회색 (`Color(0xFFE0E0E0)`) + 25dp 라운딩
- **선택 상태**: 검은색 배경 + 흰색 텍스트 + Bold
- **비선택 상태**: 투명 배경 + 검은색 텍스트 + Normal

```
┌─────────────────────────────────────┐
│ ○주○ ●월● ○년○ ○전체○              │
└─────────────────────────────────────┘
```

### 그래프 레이아웃
- **전체 너비**: 화면 가로폭 최대 활용
- **Y축 레이블**: 왼쪽 30dp 영역에 0, 1 표시
- **그래프 영역**: 나머지 공간 최대 활용
- **X축 레이블**: 그래프 하단에 가로 정렬로 표시

### 막대 그래프 스타일
- **막대 색상**: 파란색 (`Color(0xFF2196F3)`)
- **막대 너비**: 전체 너비의 70%, 간격 30%
- **배경 격자**: Y축 기준으로 가로선 표시
- **높이**: 200dp 고정

## 🔧 기술 구현 사양

### 데이터 변환 로직
```kotlin
// StatisticsUtils.kt에 구현된 함수들
fun convertToWeeklyData(records: List<SobrietyRecord>): List<Pair<String, Int>>
fun convertToMonthlyData(records: List<SobrietyRecord>): List<Pair<String, Int>>
fun convertToYearlyData(records: List<SobrietyRecord>): List<Pair<String, Int>>
fun convertToAllTimeData(records: List<SobrietyRecord>): List<Pair<String, Int>>
```

### 그래프 렌더링
- **기술**: Jetpack Compose Canvas
- **컴포넌트**: `SimpleBarChart` Composable
- **위치**: RecordsActivity 내부 구현

### 상태 관리
```kotlin
var selectedPeriod by remember { mutableStateOf("월") }
val data = remember(records, selectedPeriod) { /* 데이터 변환 */ }
```

## 📱 화면 구성

### 최종 레이아웃 구조
```
┌─────────────────────────────────────┐
│ 기간별 보기                         │
│ ○주○ ●월● ○년○ ○전체○              │
├─────────────────────────────────────┤
│ 1 ┤                                 │
│   │  █     █   █                    │
│ 0 ┤  █  █  █ █ █                    │
│   └─────────────────────────────    │
│    1  5 10 15 20 25 31             │
└─────────────────────────────────────┘
```

## 🚀 구현 단계

### Phase 1: 기본 그래프 구현 ✅
- [x] 기간 선택 UI (Segmented Control 스타일)
- [x] 막대 그래프 Canvas 구현
- [x] Y축 레이블 (0, 1) 표시
- [x] X축 레이블 동적 표시

### Phase 2: 데이터 연동 ✅
- [x] StatisticsUtils 데이터 변환 함수 구현
- [x] 실제 금주 기록 데이터와 연동
- [x] 기간별 데이터 필터링

### Phase 3: UI 최적화 ✅
- [x] 그래프 너비 화면 전체 활용
- [x] Y축과 그래프 정렬
- [x] 반응형 막대 너비 조정

### Phase 4: 고도화 (향후)
- [ ] 애니메이션 효과 추가
- [ ] 터치 인터랙션 (막대 클릭시 상세 정보)
- [ ] 그래프 스크롤 (월 모드에서 긴 데이터)

## 🔍 테스트 시나리오

### 데이터 시나리오
1. **빈 데이터**: "표시할 데이터가 없습니다" 메시지
2. **일부 성공**: 해당 기간만 막대 높이 1
3. **전체 성공**: 모든 막대 높이 1
4. **기간 전환**: 각 모드별 데이터 정확성

### UI 테스트
1. **기간 선택**: 각 버튼 클릭시 그래프 변경
2. **반응형**: 다양한 화면 크기에서 레이아웃
3. **성능**: 많은 데이터에서 렌더링 속도

## 📊 완성된 기능

### 현재 구현 상태
- ✅ iOS 스타일 기간 선택 UI
- ✅ Canvas 기반 막대 그래프
- ✅ 실시간 데이터 연동
- ✅ 4가지 기간 모드 (주/월/년/전체)
- ✅ 반응형 레이아웃

### 사용자 경험
1. 사용자가 "월" 탭 클릭
2. 이번 달 1일~31일 막대 그래프 표시
3. 성공한 금주가 있는 날은 높이 1 막대
4. 실패하거나 기록이 없는 날은 높이 0
5. 직관적인 성과 시각화로 동기부여

## 💡 핵심 성과

### 기술적 성과
- Jetpack Compose Canvas 활용한 커스텀 그래프
- 효율적인 데이터 변환 및 상태 관리
- 반응형 UI 구현

### 사용자 가치
- 금주 성과의 시각적 표현
- 기간별 성과 비교 가능
- 직관적인 인터페이스
- 지속적인 동기부여 제공

---

**📅 작성일**: 2025.08.09  
**✍️ 작성자**: GitHub Copilot  
**📝 버전**: v1.0
